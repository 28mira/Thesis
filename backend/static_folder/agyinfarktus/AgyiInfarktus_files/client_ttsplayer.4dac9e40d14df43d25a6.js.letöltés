webpackJsonpPerfectChat([34],{"0Nk4":function(t,s){t.exports={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{ref:"container"},[s("audio",{ref:"player",staticStyle:{display:"none"},attrs:{autoplay:"",muted:""}},[s("source",{ref:"source",attrs:{src:this.url,type:"audio/mpeg"}})])])},staticRenderFns:[]}},"20A8":function(t,s,i){var e=i("VU/8")(i("vC2B"),i("0Nk4"),!1,null,null,null);t.exports=e.exports},vC2B:function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=i("3D8M");s.default={name:"TtsPlayer",data:function(){return{playing:!1,duration:0,audio:null,playerinited:!1,url:"/sounds/silence.mp3"}},computed:{tts_enabled:{get:function(){return this.$store.state.client_state.tts_enabled||!1},set:function(t){this.$store.commit("setClientState",{tts_enabled:!!t})}},ttstoplay:function(){return this.$store.state.ttstoplay}},watch:{tts_enabled:function(){this.tts_enabled||this.stopTts()}},beforeDestroy:function(){e.a.$off("playTtsLink",this.playTtsLink),e.a.$off("stopTts",this.stopTts),e.a.$off("checkTts",this.checkTts),this.stopTts()},mounted:function(){e.a.$on("playTtsLink",this.playTtsLink),e.a.$on("stopTts",this.stopTts),e.a.$on("checkTts",this.checkTts),this.url=this.$store.state.settings.tts_url_prefix+this.url,window.addEventListener("touchstart",this.soundHack)},methods:{soundHack:function(){this.$refs.player.muted=!1,this.$refs.player.play(),window.removeEventListener("touchstart",this.soundHack)},stopTts:function(){this.playing&&this.audio&&(this.playing=!1,this.audio.pause(),this.audio=null)},playTtsLink:function(t){this.ttstoplay.push(t),this.checkTts()},checkTts:function(){if(!this.playing)if(this.tts_enabled){if(this.ttstoplay.length){var t=this.ttstoplay.shift();t&&this.playUrl(t)}}else this.ttstoplay.splice(0,this.ttstoplay.length)},initPlayer:function(){var t=this;this.playerinited||(this.audio.addEventListener("error",function(s){t.playing=!1,t.audio=null,t.tts_enabled=!1}),this.audio.addEventListener("loadeddata",function(){t.duration=t.audio.duration}),this.audio.addEventListener("canplaythrough",function(){t.audio.play()}),this.audio.addEventListener("ended",function(){t.playing=!1,t.audio=null,t.checkTts()}),this.playerinited=!0)},playUrl:function(t){var s=this;t=this.$store.state.settings.tts_url_prefix+t,this.audio=this.$refs.player,this.initPlayer(),this.audio.muted=!1,this.url=t,this.$refs.player.src=t,this.$nextTick(function(){s.audio.play()}),this.playing=!0}}}}});